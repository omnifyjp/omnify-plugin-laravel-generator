---
description: "STOP! These are auto-generated Omnify migrations. DO NOT EDIT these files - edit schemas/*.yaml instead and run npx omnify generate"
globs: ["{{LARAVEL_ROOT}}database/migrations/omnify/**/*.php"]
alwaysApply: true
---

# ⛔ CRITICAL: DO NOT EDIT OMNIFY MIGRATIONS

## These files are AUTO-GENERATED

All files in `database/migrations/omnify/` are automatically generated by Omnify.

**ANY MANUAL CHANGES WILL BE OVERWRITTEN** when running `npx omnify generate`.

---

## ❌ ABSOLUTELY FORBIDDEN

```php
// NEVER modify files in database/migrations/omnify/
// Even "simple fixes" will be lost!
```

| Action | Result |
|--------|--------|
| Add column manually | ❌ Overwritten on next generate |
| Modify column type | ❌ Overwritten on next generate |
| Add index manually | ❌ Overwritten on next generate |
| Fix "typo" | ❌ Overwritten on next generate |

---

## ✅ CORRECT APPROACH

### 1. Edit the YAML Schema

```yaml
# schemas/auth/User.yaml
properties:
  # Add or modify properties HERE
  new_field:
    type: String
    length: 100
```

### 2. Regenerate Migrations

```bash
npx omnify generate
php artisan migrate
```

---

## Need Custom Migration?

For changes NOT supported by Omnify schemas:

1. Create migration **OUTSIDE** the `omnify/` folder:

```bash
php artisan make:migration add_custom_field_to_users_table
# Creates: database/migrations/2026_01_12_000000_add_custom_field_to_users_table.php
# This is SAFE - Omnify won't touch it
```

2. Keep the omnify/ folder untouched

---

## Folder Structure

```
database/migrations/
├── omnify/                    ← ⛔ AUTO-GENERATED - DO NOT EDIT
│   ├── 2026_01_01_000000_create_users_table.php
│   ├── 2026_01_01_000001_create_posts_table.php
│   └── ...
├── 2026_01_12_120000_add_custom_field.php  ← ✅ Safe to edit
└── 2026_01_12_130000_custom_migration.php  ← ✅ Safe to edit
```

---

## Quick Reference

| Want to... | Do this |
|------------|---------|
| Add column | Edit schema YAML → `npx omnify generate` |
| Modify column | Edit schema YAML → `npx omnify generate` |
| Add index | Edit schema YAML → `npx omnify generate` |
| Custom migration | `php artisan make:migration` (outside omnify/) |
| Fix generation bug | Report issue or edit Omnify plugin |

---

## If You See This Warning

If a file has this header:

```php
/**
 * DO NOT EDIT - This file is auto-generated by Omnify.
 * Any changes will be overwritten on next generation.
 * ...
 */
```

**STOP!** Do not edit this file. Edit the schema YAML instead.
