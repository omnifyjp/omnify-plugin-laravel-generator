# Omnify Schema Guide

## Schema File Format

Schemas are YAML files defining data models. Each file represents one entity.

```yaml
name: User
displayName:
  ja: ユーザー
  en: User
kind: object

properties:
  email:
    type: Email
    unique: true
  name:
    type: String
  bio:
    type: Text
    nullable: true

options:
  timestamps: true
  softDelete: true
```

## Property Types

### String Types
- `String` - VARCHAR(255)
- `Text` - TEXT
- `LongText` - LONGTEXT
- `Email` - VARCHAR(255) for email addresses
- `Password` - VARCHAR(255), hidden in serialization

### Numeric Types
- `Int` - INTEGER
- `BigInt` - BIGINT
- `TinyInt` - TINYINT
- `Float` - DOUBLE
- `Decimal` - DECIMAL(precision, scale)

### Date/Time Types
- `Date` - DATE
- `Time` - TIME
- `DateTime` - DATETIME
- `Timestamp` - TIMESTAMP

### Other Types
- `Boolean` - BOOLEAN
- `Json` - JSON
- `Enum` - ENUM with values
- `EnumRef` - Reference to enum schema

## Property Options

```yaml
propertyName:
  type: String
  nullable: true       # Can be NULL
  unique: true         # Unique constraint
  default: "value"     # Default value
  length: 100          # VARCHAR length
  hidden: true         # Hide from JSON output
  fillable: false      # Exclude from mass assignment
```

## ⚠️ Default Value Rules

**DB functions NOT allowed in default:**

```yaml
# ❌ WRONG
failed_at:
  type: Timestamp
  default: CURRENT_TIMESTAMP  # ERROR!

# ✅ CORRECT
failed_at:
  type: Timestamp
  useCurrent: true            # = CURRENT_TIMESTAMP

updated_at:
  type: Timestamp
  useCurrent: true
  useCurrentOnUpdate: true    # ON UPDATE CURRENT_TIMESTAMP
```

| Type | Valid Default | Invalid |
|------|---------------|---------|
| Int | 0, 100, -1 | AUTO_INCREMENT, RAND() |
| Date | 2024-01-01 | CURRENT_DATE |
| Time | 14:30:00 | CURRENT_TIME |
| Timestamp | use `useCurrent` | CURRENT_TIMESTAMP |
| Uuid | static UUID | UUID() |

## Associations

```yaml
# Many-to-One (belongsTo)
author:
  type: Association
  relation: ManyToOne
  target: User
  onDelete: CASCADE

# One-to-Many (hasMany)
posts:
  type: Association
  relation: OneToMany
  target: Post

# Many-to-Many (belongsToMany)
tags:
  type: Association
  relation: ManyToMany
  target: Tag
  joinTable: post_tags

# Polymorphic
commentable:
  type: Association
  relation: MorphTo
```

## Indexes

```yaml
indexes:
  - columns: [status, published_at]
  - columns: [email]
    unique: true
```

## Schema Options

```yaml
options:
  timestamps: true   # Add created_at, updated_at
  softDelete: true   # Add deleted_at
  idType: BigInt     # Primary key type (Int, BigInt, Uuid)
```
