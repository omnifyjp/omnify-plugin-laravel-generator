---
paths:
  - "{{LARAVEL_ROOT}}app/Http/Controllers/**/*.php"
---

# Laravel Controller Rules

## Thin Controller Pattern

Controllers should: Validate → Delegate → Respond

```php
public function store(StoreUserRequest $request): JsonResponse
{
    // ✅ Validate (via FormRequest)
    $data = $request->validated();
    
    // ✅ Delegate (simple = Model, complex = Service)
    $user = User::create($data);
    
    // ✅ Respond (via Resource)
    return new UserResource($user);
}
```

## ⚠️ CRITICAL: OpenAPI Paths

**DO NOT add `/api` prefix!** The `api.php` route file already has it.

```php
// ❌ WRONG
#[OA\Get(path: '/api/users')]

// ✅ CORRECT
#[OA\Get(path: '/users')]
```

## Security Rules

- Always use `$request->validated()`, never `$request->all()`
- Use route model binding for single resources
- Use `authorize()` in FormRequest for authorization

## Query Patterns

```php
// ✅ List with pagination and eager loading
User::query()
    ->with(['posts', 'profile'])
    ->when($search, fn($q) => $q->where('name', 'like', "%{$search}%"))
    ->latest()
    ->paginate(15);
```

## Full Documentation

See @.claude/omnify/guides/laravel/controller.md for complete patterns.
